# ppv1

The Takuvik model is a light photosynthesis model that uses satellite data of chlorophyll-a to estimate the net primary production (NPP) in the Arctic Ocean.

The methodology of the NPP model was first published by Belanger et al. 2013 (doi:10.5194/bg-10-4087-2013). The NPP codes from Belanger et al. 2013 was modified for vertically resolved chl-a according to Ardyna et al 2013 (doi:10.5194/bg-10-4383-2013). The model was originally run using MODIS reflectances as input data. Currently the model has been adapted by the Takuvik group to use reflectances from the ESA CCI v6.0 product.

Go to trunk > Source to begin.

# Takuvik net primary production model (starter guide)

This document provides general information to quickly start with PPv1.

## Table of Contents

1. [Docker installation](#docker-installation)
2. [Download PPv1 docker](#download-ppv1-docker)
3. [Configure PPv1 input files](#configure-ppv1-input-files)
4. [Run PPv1 docker](#run-ppv1-docker)

## Docker installation (#docker-installation)

PPv1 has been build in a [Docker](https://www.docker.com/) image. The first step is to install Docker on your machine. Please consult [Docker documentation](https://docs.docker.com/install/) to install Docker on your computer.

## Download PPv1 docker

Once Docker is installed, you will need to pull PPv1 image on your machine. At this time, the docker is private and you will need to log on [Docker Hub](https://hub.docker.com/) first.  You will need to ask your system administrator for access granted.

```bash=
docker login
docker pull takuvik/ppv1
```

## Configure PPv1 input files

A JSON configuration file is needed to run PPv1. This file provides information about the user inputs to be used within PPv1.

###  Required variables

`calculation_start_date`: first date to calculate  
`calculation_end_date`: last date to calculate (only one day if `calculation_start_date` == `calculation_start_date`)  
`calculation_time_step_in_offset_alias`: string to specify time step in python [pandas offset](https://pandas.pydata.org/pandas-docs/stable/timeseries.html#timeseries-offset-aliases)  

`input_file`: a dictionary of input files referred in the variable section. 
* `input_file_name`: name of the input file name as referred in the variable section
    * `file_path_template_type`: value to resolve in the path and filename format for each date   (takes one of the following value)
        * `constant_file`: `/.../folder/my_file.csv`
        * `fixed_directory_variable_file_ymd`: `/.../folder/my_file_{yyyy}_{mm}_{dd}.csv`
        * `year_and_day_of_year` : `/.../{yyyy}/{doy}/my_file_{yyyy}_{doy}.csv`
    * `path_format`: base path for each file: ".../folder/{}/{}"
    * `file_name_format` : "data_rimouski_ppv1_{}{}{}.csv"
    * `type`: type of file to load   (takes one of the following value)
        * `netcdf_from_ppv0`: legacy support (ppv0 output)
        * `netcdf_from_bloomstate2`: Output generated by bloomstate script
        * `netcdf_indexed_one_level`: Regular NetCDF, with variables at the root
        * `base`: Loading behavior is explicitly coded by file (avoid usage)
        * `flat_json`: JSON with all values at it's root
        * `csv`: Regular CSV file
    * `details` (optional) : dictionary of special variable to use. Mostly used for passing indexing variable name
        * `{index_variable" : "bin_index"}`

`variable`: dictionnary of all variable to be used (all are mendatory)
* `variable_name` : 
    * `input_file_name`: reference to input_file farther down in the exmaple
    * `column_name`: reference to the column name within the file  
    * `type`: type of value to extract (takes one of the following value)
        * `single_value`: a scalar value (used for boolean etc.)
        * `vector`: a one dimension indexed vector (used with pixel index)
        * `2_dimentions` : a two dimensions indexed matrix (use with pixel index and depth, ex.: Eric R. bloomstate 2)
    * `details` (optional): dictionnary for special variable type.
    


`output_configuration`: a dictionary of values for output
* `path_format`: output equivalent of the input file path format
* `file_name_format`: output equivalent of the input file path format


An example configuration file is presented in the README of the tutorial, as well as an example of running the model with the data provided as input for the example.

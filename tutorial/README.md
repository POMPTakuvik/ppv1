# PPv1 tutorial

All the data (atmospheric, Rrs, Chl, bathymetry, LUT) and the configuration files needed to run this demo are located in the `tutorial` folder of the [NPP repository]. This demo will show how to run PPv1 to calculate integrated daily primary production for 2019-08-17 (year day 229 of 2019) using CCI data and vertical chlorophyll profile generated by bloomstate2.

## Install Docker

### Docker installation

PPv1 has been build in a [Docker](https://www.docker.com/) image. The first step is to install Docker on your machine. Please consult [Docker documentation](https://docs.docker.com/install/) to install Docker on your computer. Note that this document is not about teaching you how to use Docker. You will have to learn it by yourself.

### Download PPv1 docker

Once Docker is installed, you will need to pull the NPP image on your machine. At this time, the docker is private and you will need to log on [Docker Hub](https://hub.docker.com/) first. Create an account if needed. 


## Running the example

Once the `ppv1` docker is installed, you will be able to execute the ppv1 model after make some changes to the configuration file. To make changes you must to download the ppv1 codes in your computer


## Downloading PPv1 code

The code of PPv1 can be modified. You will have to first download the code on your computer from the repository from GitHub (download manually or via GIT clone)

### Editing configuration file

The configuration file used in the example is located in <YOUR_LocalFolder>ppv1/tutorial/InputData/config/

In the example we process the day number 229 of the year 2019. This corresponds to 17 August 2019. Then in this case the start and end date are the same
Note the NPP Model needs the data arranged in folder that follow a 'year' and 'day of the year' structure. For example, a folder in your computer "<YOUR_LocalFolder>/NPP/tutorial/InputData/MODISA/L3BIN/2019/229/" for the atmospheric MODISA products.

line 2 -> "calculation_start_date": "2019-08-17T00:00:00.000Z" 
line 3 -> "calculation_end_date": "2019-08-17T00:00:00.000Z"

<YOUR_LocalFolder> is the Folder where you download the NPP repository in your machine.
<"OutputDataFolder"> is the Folder where you will save the NPP output

line 10 -> "path_format": "<YOUR_LocalFolder>/NPP/tutorial/InputData/2019/229/",
line 19 -> "path_format": "<YOUR_LocalFolder>/NPP/tutorial/InputData/2019/229/",
line 28 -> "path_format": "<YOUR_LocalFolder>/NPP/tutorial/InputData/2019/229/",
line 37 -> "path_format": "<YOUR_LocalFolder>/NPP/tutorial/InputData/",
line 46 -> "path_format": "<YOUR_LocalFolder>/NPP/tutorial/InputData/",
line 52 -> "path_format": "<YOUR_LocalFolder>/NPP/tutorial/InputData/",
line 137 -> "path_format": <"OutputDataFolder">,


### Modify the code

Once you have downloaded the PPv1 repository, you can browse and modify the source code contained in the Source folder.

### Docker build PPv1

After you have made modifications to the source code, you will have to rebuild the PPv1 docker:

```bash
docker build -t ppv1 .
```

**Note that you need to be in the `Source` folder (<YOUR_LocalFolder>ppv1/trunk/Source), where the `Dockerfile` is located, to run the build command.**

After a successful docker builds, you can run it as before.

```bash
docker run -it \
-v <YOUR_LocalFolder>ppv1/tutorial/InputData/config:/takuvik/configuration_file \
-v <YOUR_LocalFolder>ppv1/tutorial/InputData/:/data/ \
takuvik/ppv1 configuration_file/config_example.json
```


## Using new data with PPv1

If you want to use your data (Rrs, Chl, Ozone, etc.) with PPv1, you have to use the NetCDF files that have the same structure as the ones currently used. If the data is not formatted the same way as it is currently supported by PPv1, you have two options:

1. Modify the code of PPv1 to make it able to read your new data.
2. Create code to make your data in a format compatible with PPv1.
